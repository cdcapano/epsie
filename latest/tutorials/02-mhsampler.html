<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Example of creating and running a Metropolis-Hastings Sampler &mdash; EPSIE 1.0 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Example of creating and running a Parallel Tempered Sampler" href="03-ptsampler.html" />
    <link rel="prev" title="Using a chain" href="01-chain.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> EPSIE
          </a>
              <div class="version">
                1.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../quickstart.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="../parallelization.html">Parallelization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../proposals.html">Proposals</a></li>
<li class="toctree-l1"><a class="reference internal" href="../epsie.html">API Reference</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tutorials:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="01-chain.html">Using a chain</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Example of creating and running a Metropolis-Hastings Sampler</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#create-the-model-to-sample">Create the model to sample</a></li>
<li class="toctree-l2"><a class="reference internal" href="#setup-and-run-the-sampler">Setup and run the sampler</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#lets-run-it">Let’s run it!</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#extract-results">Extract results</a></li>
<li class="toctree-l2"><a class="reference internal" href="#resume-from-a-state">Resume from a state</a></li>
<li class="toctree-l2"><a class="reference internal" href="#clearing-memory-and-continuing">Clearing memory and continuing</a></li>
<li class="toctree-l2"><a class="reference internal" href="#plot-the-posterior">Plot the posterior</a></li>
<li class="toctree-l2"><a class="reference internal" href="#create-an-animation-of-the-results">Create an animation of the results</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="03-ptsampler.html">Example of creating and running a Parallel Tempered Sampler</a></li>
<li class="toctree-l1"><a class="reference internal" href="test_adaptive_normal.html">Use the Veitch et al. Adaptive Normal proposal with the Parallel Tempered Sampler</a></li>
<li class="toctree-l1"><a class="reference internal" href="test_angular.html">The Angular proposal</a></li>
<li class="toctree-l1"><a class="reference internal" href="test_at_adaptive_normal.html">The AT Adaptive Normal proposal</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">EPSIE</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Example of creating and running a Metropolis-Hastings Sampler</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/cdcapano/epsie/blob/master/docs/tutorials/02-mhsampler.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="example-of-creating-and-running-a-metropolis-hastings-sampler">
<h1>Example of creating and running a Metropolis-Hastings Sampler<a class="headerlink" href="#example-of-creating-and-running-a-metropolis-hastings-sampler" title="Permalink to this headline"></a></h1>
<p>In this notebook we will setup a sampler to sample a 2D Gaussian
distribution with mean <span class="math notranslate nohighlight">\(\bar{x} = 2, \bar{y} = 5\)</span> and variance
<span class="math notranslate nohighlight">\(\sigma_x^2 = 1\)</span>, <span class="math notranslate nohighlight">\(\sigma_y^2 = 2\)</span>;
<span class="math notranslate nohighlight">\(\sigma^2_{xy} = \sigma^2_{yx} = 0\)</span>, using a prior that is uniform
over <span class="math notranslate nohighlight">\(x \in [-20, 20)\)</span>, <span class="math notranslate nohighlight">\(y\in[-40, 40)\)</span>.</p>
<p>We will use Python’s multiprocessing to evolve 12 chains using 4 cores.
We will demonstrate that resuming a sampler from it’s state attribute
yields the same results as if we had run continuously. We then make a
plot of the posterior. Finally, we make an animation showing how the 12
chains moved.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">matplotlib</span> notebook
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span>
<span class="kn">import</span> <span class="nn">numpy</span>

<span class="kn">import</span> <span class="nn">epsie</span>
<span class="kn">from</span> <span class="nn">epsie.samplers</span> <span class="kn">import</span> <span class="n">MetropolisHastingsSampler</span>
<span class="kn">import</span> <span class="nn">multiprocessing</span>
</pre></div>
</div>
<section id="create-the-model-to-sample">
<h2>Create the model to sample<a class="headerlink" href="#create-the-model-to-sample" title="Permalink to this headline"></a></h2>
<p><strong>Note:</strong> Below we create a class with several functions to draw samples
from the prior and to evaluate the log posterior. This isn’t strictly
necessary. The only thing the Sampler really requires is a function that
it can pass keyword arguments to and get back a tuple of (log
likelihood, log prior). However, setting things up as a class will make
it convenient to, e.g., draw random samples from the prior for the
starting positiions, as well as plot the model later on.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">stats</span>
<span class="k">class</span> <span class="nc">Model</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># we&#39;ll use a 2D Gaussian for the likelihood distribution</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">params</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mean</span> <span class="o">=</span> <span class="p">[</span><span class="mf">2.</span><span class="p">,</span> <span class="mf">5.</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cov</span> <span class="o">=</span> <span class="p">[[</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">]]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">likelihood_dist</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">multivariate_normal</span><span class="p">(</span><span class="n">mean</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mean</span><span class="p">,</span>
                                                         <span class="n">cov</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cov</span><span class="p">)</span>

        <span class="c1"># we&#39;ll just use a uniform prior</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prior_bounds</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="mf">20.</span><span class="p">,</span> <span class="mf">20.</span><span class="p">),</span>
                             <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="mf">40.</span><span class="p">,</span> <span class="mf">40.</span><span class="p">)}</span>
        <span class="n">xmin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prior_bounds</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">dx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prior_bounds</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">xmin</span>
        <span class="n">ymin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prior_bounds</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">dy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prior_bounds</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">ymin</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prior_dist</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="n">stats</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">xmin</span><span class="p">,</span> <span class="n">dx</span><span class="p">),</span>
                           <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="n">stats</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">ymin</span><span class="p">,</span> <span class="n">dy</span><span class="p">)}</span>

    <span class="k">def</span> <span class="nf">prior_rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span><span class="n">p</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">prior_dist</span><span class="p">[</span><span class="n">p</span><span class="p">]</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">}</span>

    <span class="k">def</span> <span class="nf">logprior</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">prior_dist</span><span class="p">[</span><span class="n">p</span><span class="p">]</span><span class="o">.</span><span class="n">logpdf</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="n">p</span><span class="p">])</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">loglikelihood</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">likelihood_dist</span><span class="o">.</span><span class="n">logpdf</span><span class="p">([</span><span class="n">kwargs</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">])</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">logp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">logprior</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">logp</span> <span class="o">==</span> <span class="o">-</span><span class="n">numpy</span><span class="o">.</span><span class="n">inf</span><span class="p">:</span>
            <span class="n">logl</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loglikelihood</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">logl</span><span class="p">,</span> <span class="n">logp</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">Model</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="setup-and-run-the-sampler">
<h2>Setup and run the sampler<a class="headerlink" href="#setup-and-run-the-sampler" title="Permalink to this headline"></a></h2>
<p>Create a pool of 4 parallel processes, then initialize the sampler using
the model we created above.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nchains</span> <span class="o">=</span> <span class="mi">12</span>
<span class="n">nprocs</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">pool</span> <span class="o">=</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">Pool</span><span class="p">(</span><span class="n">nprocs</span><span class="p">)</span>
<span class="c1">#pool = None</span>

<span class="n">sampler</span> <span class="o">=</span> <span class="n">MetropolisHastingsSampler</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">params</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">nchains</span><span class="p">,</span> <span class="n">pool</span><span class="o">=</span><span class="n">pool</span><span class="p">)</span>
</pre></div>
</div>
<p>Now set the starting positions of the chains by drawing random variates
from the model’s prior.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sampler</span><span class="o">.</span><span class="n">start_position</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">prior_rvs</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">nchains</span><span class="p">)</span>
</pre></div>
</div>
<section id="lets-run-it">
<h3>Let’s run it!<a class="headerlink" href="#lets-run-it" title="Permalink to this headline"></a></h3>
<p>This will evolve each chain in the collection by 256 steps. This is
parallelized over the pool of processes.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sampler</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="mi">256</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="extract-results">
<h2>Extract results<a class="headerlink" href="#extract-results" title="Permalink to this headline"></a></h2>
<p>We can get the history of all of the chains using the <code class="docutils literal notranslate"><span class="pre">.positions</span></code>
attribute. This will return a numpy structured array in which the fields
are the parameters names (in this case, <code class="docutils literal notranslate"><span class="pre">'x'</span></code> and <code class="docutils literal notranslate"><span class="pre">'y'</span></code>), and with
shape <code class="docutils literal notranslate"><span class="pre">nchains</span> <span class="pre">x</span> <span class="pre">niterations</span></code>:</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">positions</span> <span class="o">=</span> <span class="n">sampler</span><span class="o">.</span><span class="n">positions</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;sampler.positions: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">positions</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;with fields: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">positions</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;and shape:&#39;</span><span class="p">,</span> <span class="n">positions</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>sampler.positions: &lt;class &#39;numpy.ndarray&#39;&gt;
with fields: (&#39;x&#39;, &#39;y&#39;)
and shape: (12, 256)
</pre></div>
</div>
<p>This (or any structured array returned by epsie) can be turned into a
dictionary of arrays, where the keys are the parameter names, using
<code class="docutils literal notranslate"><span class="pre">epsie.array2dict</span></code>:</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">positions</span> <span class="o">=</span> <span class="n">epsie</span><span class="o">.</span><span class="n">array2dict</span><span class="p">(</span><span class="n">sampler</span><span class="o">.</span><span class="n">positions</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;sampler.positions: </span><span class="si">{}</span><span class="s1"> with keys/values:&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">positions</span><span class="p">)))</span>
<span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">positions</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&quot;</span><span class="si">{}</span><span class="s1">&quot;: </span><span class="si">{}</span><span class="s1"> with shape </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">positions</span><span class="p">[</span><span class="n">param</span><span class="p">]),</span> <span class="n">positions</span><span class="p">[</span><span class="n">param</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>sampler.positions: &lt;class &#39;dict&#39;&gt; with keys/values:
&quot;x&quot;: &lt;class &#39;numpy.ndarray&#39;&gt; with shape (12, 256)
&quot;y&quot;: &lt;class &#39;numpy.ndarray&#39;&gt; with shape (12, 256)
</pre></div>
</div>
<p>We can also access the history of log likelihoods and log priors using
<code class="docutils literal notranslate"><span class="pre">sampler.stats</span></code>, as well as the acceptance ratios and which jumps were
accepted with <code class="docutils literal notranslate"><span class="pre">sampler.acceptance</span></code>:</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stats</span> <span class="o">=</span> <span class="n">sampler</span><span class="o">.</span><span class="n">stats</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;sampler.stats: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">stats</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;with fields: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;and shape:&#39;</span><span class="p">,</span> <span class="n">stats</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>sampler.stats: &lt;class &#39;numpy.ndarray&#39;&gt;
with fields: (&#39;logl&#39;, &#39;logp&#39;)
and shape: (12, 256)
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">acceptance</span> <span class="o">=</span> <span class="n">sampler</span><span class="o">.</span><span class="n">acceptance</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;sampler.acceptance: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">acceptance</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;with fields: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">acceptance</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;and shape:&#39;</span><span class="p">,</span> <span class="n">acceptance</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>sampler.acceptance: &lt;class &#39;numpy.ndarray&#39;&gt;
with fields: (&#39;acceptance_ratio&#39;, &#39;accepted&#39;)
and shape: (12, 256)
</pre></div>
</div>
<p>If the model returned “blobs” (i.e., the model returns a dictionary
along with the logl and logp), then we can also access those using
<code class="docutils literal notranslate"><span class="pre">sampler.blobs</span></code>. Similar to <code class="docutils literal notranslate"><span class="pre">positions</span></code>, this would also be a
dictionary of arrays with keys given by the names in the dictionary the
model returned. However, because our model above returns no blobs, in
this case we just get <code class="docutils literal notranslate"><span class="pre">None</span></code>:</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">sampler</span><span class="o">.</span><span class="n">blobs</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kc">None</span>
</pre></div>
</div>
<p>The individual chains can be accessed using the <code class="docutils literal notranslate"><span class="pre">.chains</span></code> attribute:</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sampler</span><span class="o">.</span><span class="n">chains</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="o">&lt;</span><span class="n">epsie</span><span class="o">.</span><span class="n">chain</span><span class="o">.</span><span class="n">chain</span><span class="o">.</span><span class="n">Chain</span> <span class="n">at</span> <span class="mh">0x1226544d0</span><span class="o">&gt;</span><span class="p">,</span>
 <span class="o">&lt;</span><span class="n">epsie</span><span class="o">.</span><span class="n">chain</span><span class="o">.</span><span class="n">chain</span><span class="o">.</span><span class="n">Chain</span> <span class="n">at</span> <span class="mh">0x122654c90</span><span class="o">&gt;</span><span class="p">,</span>
 <span class="o">&lt;</span><span class="n">epsie</span><span class="o">.</span><span class="n">chain</span><span class="o">.</span><span class="n">chain</span><span class="o">.</span><span class="n">Chain</span> <span class="n">at</span> <span class="mh">0x122654690</span><span class="o">&gt;</span><span class="p">,</span>
 <span class="o">&lt;</span><span class="n">epsie</span><span class="o">.</span><span class="n">chain</span><span class="o">.</span><span class="n">chain</span><span class="o">.</span><span class="n">Chain</span> <span class="n">at</span> <span class="mh">0x12265a210</span><span class="o">&gt;</span><span class="p">,</span>
 <span class="o">&lt;</span><span class="n">epsie</span><span class="o">.</span><span class="n">chain</span><span class="o">.</span><span class="n">chain</span><span class="o">.</span><span class="n">Chain</span> <span class="n">at</span> <span class="mh">0x122654ed0</span><span class="o">&gt;</span><span class="p">,</span>
 <span class="o">&lt;</span><span class="n">epsie</span><span class="o">.</span><span class="n">chain</span><span class="o">.</span><span class="n">chain</span><span class="o">.</span><span class="n">Chain</span> <span class="n">at</span> <span class="mh">0x12265a950</span><span class="o">&gt;</span><span class="p">,</span>
 <span class="o">&lt;</span><span class="n">epsie</span><span class="o">.</span><span class="n">chain</span><span class="o">.</span><span class="n">chain</span><span class="o">.</span><span class="n">Chain</span> <span class="n">at</span> <span class="mh">0x12265c850</span><span class="o">&gt;</span><span class="p">,</span>
 <span class="o">&lt;</span><span class="n">epsie</span><span class="o">.</span><span class="n">chain</span><span class="o">.</span><span class="n">chain</span><span class="o">.</span><span class="n">Chain</span> <span class="n">at</span> <span class="mh">0x12266fcd0</span><span class="o">&gt;</span><span class="p">,</span>
 <span class="o">&lt;</span><span class="n">epsie</span><span class="o">.</span><span class="n">chain</span><span class="o">.</span><span class="n">chain</span><span class="o">.</span><span class="n">Chain</span> <span class="n">at</span> <span class="mh">0x12265c890</span><span class="o">&gt;</span><span class="p">,</span>
 <span class="o">&lt;</span><span class="n">epsie</span><span class="o">.</span><span class="n">chain</span><span class="o">.</span><span class="n">chain</span><span class="o">.</span><span class="n">Chain</span> <span class="n">at</span> <span class="mh">0x12265c110</span><span class="o">&gt;</span><span class="p">,</span>
 <span class="o">&lt;</span><span class="n">epsie</span><span class="o">.</span><span class="n">chain</span><span class="o">.</span><span class="n">chain</span><span class="o">.</span><span class="n">Chain</span> <span class="n">at</span> <span class="mh">0x1226549d0</span><span class="o">&gt;</span><span class="p">,</span>
 <span class="o">&lt;</span><span class="n">epsie</span><span class="o">.</span><span class="n">chain</span><span class="o">.</span><span class="n">chain</span><span class="o">.</span><span class="n">Chain</span> <span class="n">at</span> <span class="mh">0x12267cd50</span><span class="o">&gt;</span><span class="p">]</span>
</pre></div>
</div>
</section>
<section id="resume-from-a-state">
<h2>Resume from a state<a class="headerlink" href="#resume-from-a-state" title="Permalink to this headline"></a></h2>
<p>The sampler can be checkpointed by getting its current state with
<code class="docutils literal notranslate"><span class="pre">sampler.state</span></code>. To demonstrate this, we’ll get the current state of
the sampler, then run it for another set of iterations. We’ll then
create a new sampler, and set it’s state to the state we obtained from
first sampler. Running the same sampler for the same number of
iterations should produce the same results.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># get the current state</span>
<span class="n">state</span> <span class="o">=</span> <span class="n">sampler</span><span class="o">.</span><span class="n">state</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># now advance the sampler for another 256 iterations</span>
<span class="n">sampler</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="mi">256</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># create a new sampler, but set it&#39;s state to what the original sampler&#39;s was after the first 250 iterations</span>
<span class="n">sampler2</span> <span class="o">=</span> <span class="n">MetropolisHastingsSampler</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">params</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">nchains</span><span class="p">,</span> <span class="n">pool</span><span class="o">=</span><span class="n">pool</span><span class="p">)</span>
<span class="n">sampler2</span><span class="o">.</span><span class="n">set_state</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># now advance the new sampler for 256 iterations</span>
<span class="c1"># note that we don&#39;t have to run set_start first, since the starting positions have been set by set_start</span>
<span class="n">sampler2</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="mi">256</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># compare the current results; they should be the same between sampler2 and sampler</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;x:&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">sampler</span><span class="o">.</span><span class="n">current_positions</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">sampler2</span><span class="o">.</span><span class="n">current_positions</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">all</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;y:&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">sampler</span><span class="o">.</span><span class="n">current_positions</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">sampler2</span><span class="o">.</span><span class="n">current_positions</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">all</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;logl:&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">sampler</span><span class="o">.</span><span class="n">current_stats</span><span class="p">[</span><span class="s1">&#39;logl&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">sampler2</span><span class="o">.</span><span class="n">current_stats</span><span class="p">[</span><span class="s1">&#39;logl&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">all</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;logp:&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">sampler</span><span class="o">.</span><span class="n">current_stats</span><span class="p">[</span><span class="s1">&#39;logp&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">sampler2</span><span class="o">.</span><span class="n">current_stats</span><span class="p">[</span><span class="s1">&#39;logp&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">all</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;acceptance ratio:&#39;</span><span class="p">,</span>
      <span class="p">(</span><span class="n">sampler</span><span class="o">.</span><span class="n">acceptance</span><span class="p">[</span><span class="s1">&#39;acceptance_ratio&#39;</span><span class="p">][:,</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">sampler2</span><span class="o">.</span><span class="n">acceptance</span><span class="p">[</span><span class="s1">&#39;acceptance_ratio&#39;</span><span class="p">][:,</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">all</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;accepted:&#39;</span><span class="p">,</span>
      <span class="p">(</span><span class="n">sampler</span><span class="o">.</span><span class="n">acceptance</span><span class="p">[</span><span class="s1">&#39;accepted&#39;</span><span class="p">][:,</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">sampler2</span><span class="o">.</span><span class="n">acceptance</span><span class="p">[</span><span class="s1">&#39;accepted&#39;</span><span class="p">][:,</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">all</span><span class="p">())</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">x</span><span class="p">:</span> <span class="kc">True</span>
<span class="n">y</span><span class="p">:</span> <span class="kc">True</span>
<span class="n">logl</span><span class="p">:</span> <span class="kc">True</span>
<span class="n">logp</span><span class="p">:</span> <span class="kc">True</span>
<span class="n">acceptance</span> <span class="n">ratio</span><span class="p">:</span> <span class="kc">True</span>
<span class="n">accepted</span><span class="p">:</span> <span class="kc">True</span>
</pre></div>
</div>
</section>
<section id="clearing-memory-and-continuing">
<h2>Clearing memory and continuing<a class="headerlink" href="#clearing-memory-and-continuing" title="Permalink to this headline"></a></h2>
<p>The history of results in memory can be cleared using <code class="docutils literal notranslate"><span class="pre">.clear()</span></code>.
Running the sampler after a clear yields the same results as if no clear
had been done. This is useful for keeping memory usage down: you can
dump results to a file after some number of iterations, clear, then
continue.</p>
<p>To demonstrate this, we’ll clear <code class="docutils literal notranslate"><span class="pre">sampler2</span></code>, then run both <code class="docutils literal notranslate"><span class="pre">sampler</span></code>
and <code class="docutils literal notranslate"><span class="pre">sampler2</span></code> for another 512 iterations. We’ll then compare the
current results; they should be the same.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sampler2</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sampler</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="mi">512</span><span class="p">)</span>
<span class="n">sampler2</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="mi">512</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># compare the current results; they should be the same between sampler2 and sampler</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;x:&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">sampler</span><span class="o">.</span><span class="n">current_positions</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">sampler2</span><span class="o">.</span><span class="n">current_positions</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">all</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;y:&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">sampler</span><span class="o">.</span><span class="n">current_positions</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">sampler2</span><span class="o">.</span><span class="n">current_positions</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">all</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;logl:&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">sampler</span><span class="o">.</span><span class="n">current_stats</span><span class="p">[</span><span class="s1">&#39;logl&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">sampler2</span><span class="o">.</span><span class="n">current_stats</span><span class="p">[</span><span class="s1">&#39;logl&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">all</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;logp:&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">sampler</span><span class="o">.</span><span class="n">current_stats</span><span class="p">[</span><span class="s1">&#39;logp&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">sampler2</span><span class="o">.</span><span class="n">current_stats</span><span class="p">[</span><span class="s1">&#39;logp&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">all</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;acceptance ratio:&#39;</span><span class="p">,</span>
      <span class="p">(</span><span class="n">sampler</span><span class="o">.</span><span class="n">acceptance</span><span class="p">[</span><span class="s1">&#39;acceptance_ratio&#39;</span><span class="p">][:,</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">sampler2</span><span class="o">.</span><span class="n">acceptance</span><span class="p">[</span><span class="s1">&#39;acceptance_ratio&#39;</span><span class="p">][:,</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">all</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;accepted:&#39;</span><span class="p">,</span>
      <span class="p">(</span><span class="n">sampler</span><span class="o">.</span><span class="n">acceptance</span><span class="p">[</span><span class="s1">&#39;accepted&#39;</span><span class="p">][:,</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">sampler2</span><span class="o">.</span><span class="n">acceptance</span><span class="p">[</span><span class="s1">&#39;accepted&#39;</span><span class="p">][:,</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">all</span><span class="p">())</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">x</span><span class="p">:</span> <span class="kc">True</span>
<span class="n">y</span><span class="p">:</span> <span class="kc">True</span>
<span class="n">logl</span><span class="p">:</span> <span class="kc">True</span>
<span class="n">logp</span><span class="p">:</span> <span class="kc">True</span>
<span class="n">acceptance</span> <span class="n">ratio</span><span class="p">:</span> <span class="kc">True</span>
<span class="n">accepted</span><span class="p">:</span> <span class="kc">True</span>
</pre></div>
</div>
</section>
<section id="plot-the-posterior">
<h2>Plot the posterior<a class="headerlink" href="#plot-the-posterior" title="Permalink to this headline"></a></h2>
<p>Let’s create a scatter plot of the posterior. For this, we’ll need to
throw out some earlier samples for the burn-in period; we’ll just assume
the first-half of the chains were burn in. We also need to calculate the
autocorrelation length of the chains in order to get independent
samples.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">calculate_acf</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculates the autocorrelation of some data&quot;&quot;&quot;</span>
    <span class="c1"># zero the mean</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span> <span class="o">-</span> <span class="n">data</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="c1"># zero-pad to 2 * nearest power of 2</span>
    <span class="n">newlen</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">numpy</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)))))</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">newlen</span><span class="p">)</span>
    <span class="n">x</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:]</span>
    <span class="c1"># correlate</span>
    <span class="n">acf</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">correlate</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;full&#39;</span><span class="p">)</span>
    <span class="c1"># drop corrupted region</span>
    <span class="n">acf</span> <span class="o">=</span> <span class="n">acf</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">acf</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span><span class="p">:]</span>
    <span class="c1"># normalize</span>
    <span class="n">acf</span> <span class="o">/=</span> <span class="n">acf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">acf</span>

<span class="k">def</span> <span class="nf">calculate_acl</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculates the autocorrelation length of some data.</span>

<span class="sd">    Algorithm used is from:</span>
<span class="sd">    N. Madras and A.D. Sokal, J. Stat. Phys. 50, 109 (1988).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># calculate the acf</span>
    <span class="n">acf</span> <span class="o">=</span> <span class="n">calculate_acf</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="c1"># now the ACL: Following from Sokal, this is estimated</span>
    <span class="c1"># as the first point where M*tau[k] &lt;= k, where</span>
    <span class="c1"># tau = 2*cumsum(acf) - 1, and M is a tuneable parameter,</span>
    <span class="c1"># generally chosen to be = 5 (which we use here)</span>
    <span class="n">m</span> <span class="o">=</span> <span class="mi">5</span>
    <span class="n">cacf</span> <span class="o">=</span> <span class="mf">2.</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">acf</span><span class="p">)</span> <span class="o">-</span> <span class="mf">1.</span>
    <span class="n">win</span> <span class="o">=</span> <span class="n">m</span> <span class="o">*</span> <span class="n">cacf</span> <span class="o">&lt;=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cacf</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">win</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
        <span class="n">acl</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">cacf</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">win</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]]))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># data is too short to estimate the ACL, just choose</span>
        <span class="c1"># the length of the data</span>
        <span class="n">acl</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">acl</span>
</pre></div>
</div>
<p>Since the chains are completely independent of each other, we can
calculate the ACL separately for each chain. However, if you’d like to
be more conservative, you can also just take the max over all of the
chains.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># get the samples; recall that this is a dictionary of</span>
<span class="c1"># nchains x niterations arrays for each parameter</span>
<span class="n">samples</span> <span class="o">=</span> <span class="n">sampler</span><span class="o">.</span><span class="n">positions</span>
<span class="c1"># as we said above, we&#39;ll assume the first half</span>
<span class="c1"># of the chain was burn in</span>
<span class="n">burnin_iter</span> <span class="o">=</span> <span class="n">sampler</span><span class="o">.</span><span class="n">niterations</span> <span class="o">//</span> <span class="mi">2</span>
<span class="c1"># set up arrays to store the ACL of each chain and</span>
<span class="c1"># the thinned chains</span>
<span class="n">acls</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nchains</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
<span class="n">thinned_arrays</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="p">[]}</span>
<span class="c1"># cycle over the chains, calculating the ACLs and thinning them</span>
<span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nchains</span><span class="p">):</span>
    <span class="c1"># get the second half of the chains</span>
    <span class="n">sx</span> <span class="o">=</span> <span class="n">samples</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">][</span><span class="n">ii</span><span class="p">,</span> <span class="n">burnin_iter</span><span class="p">:]</span>
    <span class="n">sy</span> <span class="o">=</span> <span class="n">samples</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">][</span><span class="n">ii</span><span class="p">,</span> <span class="n">burnin_iter</span><span class="p">:]</span>
    <span class="c1"># compute the acl for each parameter</span>
    <span class="n">aclx</span> <span class="o">=</span> <span class="n">calculate_acl</span><span class="p">(</span><span class="n">sx</span><span class="p">)</span>
    <span class="n">acly</span> <span class="o">=</span> <span class="n">calculate_acl</span><span class="p">(</span><span class="n">sy</span><span class="p">)</span>
    <span class="n">acl</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">aclx</span><span class="p">,</span> <span class="n">acly</span><span class="p">)</span>
    <span class="n">acls</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="n">acl</span>
    <span class="c1"># note that we&#39;ll thin the arrays starting from the</span>
    <span class="c1"># end to get the lastest results</span>
    <span class="n">thinned_arrays</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sx</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">][::</span><span class="n">acl</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">thinned_arrays</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sy</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">][::</span><span class="n">acl</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># the ACL of each chain:</span>
<span class="nb">print</span><span class="p">(</span><span class="n">acls</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="mi">23</span> <span class="mi">10</span>  <span class="mi">6</span>  <span class="mi">9</span> <span class="mi">13</span> <span class="mi">12</span> <span class="mi">19</span> <span class="mi">10</span> <span class="mi">18</span> <span class="mi">24</span> <span class="mi">24</span> <span class="mi">19</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># create a flattened posterior array</span>
<span class="n">posterior</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">thinned_arrays</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]),</span>
             <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">thinned_arrays</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">])}</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number of independent samples:&quot;</span><span class="p">,</span> <span class="n">posterior</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Number</span> <span class="n">of</span> <span class="n">independent</span> <span class="n">samples</span><span class="p">:</span> <span class="mi">480</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># histogram them</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">pyplot</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">posterior</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">posterior</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">IPython</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">Javascript</span> <span class="nb">object</span><span class="o">&gt;</span>
</pre></div>
</div>
<img src="data:image/png;base64,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" width="639.8333333333334"><p>Let’s check the mean and variance of our estimated posterior. These
should be <span class="math notranslate nohighlight">\(\bar{x} \approx 2, \sigma^2_{x} \approx 1\)</span> and
<span class="math notranslate nohighlight">\(\bar{y} \approx 5, \sigma^2_{y} \approx 2\)</span>:</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">posterior</span><span class="p">:</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">posterior</span><span class="p">[</span><span class="n">param</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="s1">&#39;mean: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">mean</span><span class="p">()),</span> <span class="s1">&#39;var: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">var</span><span class="p">()))</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="n">mean</span><span class="p">:</span> <span class="mf">1.99478140402679</span> <span class="n">var</span><span class="p">:</span> <span class="mf">0.8584428515335814</span>
<span class="n">y</span> <span class="n">mean</span><span class="p">:</span> <span class="mf">5.178616585856629</span> <span class="n">var</span><span class="p">:</span> <span class="mf">1.9987894875419652</span>
</pre></div>
</div>
<p>The values are close, but not exact. This isn’t too surprising since we
only have <span class="math notranslate nohighlight">\(\mathcal{O}(100)\)</span> samples. To get more samples, the
sampler can be run longer.</p>
</section>
<section id="create-an-animation-of-the-results">
<h2>Create an animation of the results<a class="headerlink" href="#create-an-animation-of-the-results" title="Permalink to this headline"></a></h2>
<p>To visualize the results, we’ll create an animation showing how the
chains evolved. We’ll do this by plotting one point for each chain, with
each frame in the animation representing a single iteration.</p>
<p><strong>Note: To keep file size down, the animation has not been created for
the version of this notebook uploaded to the repository.</strong></p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">animation</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Prepare an array to create a density map showing the shape of the model posterior</span>
<span class="n">npts</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">xmean</span><span class="p">,</span> <span class="n">ymean</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">likelihood_dist</span><span class="o">.</span><span class="n">mean</span>
<span class="n">xsig</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">likelihood_dist</span><span class="o">.</span><span class="n">cov</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mf">0.5</span>
<span class="n">ysig</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">likelihood_dist</span><span class="o">.</span><span class="n">cov</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mf">0.5</span>
<span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">mgrid</span><span class="p">[</span><span class="n">xmean</span><span class="o">-</span><span class="mi">3</span><span class="o">*</span><span class="n">xsig</span><span class="p">:</span><span class="n">xmean</span><span class="o">+</span><span class="mi">3</span><span class="o">*</span><span class="n">xsig</span><span class="p">:</span><span class="nb">complex</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">npts</span><span class="p">),</span>
                   <span class="n">ymean</span><span class="o">-</span><span class="mi">3</span><span class="o">*</span><span class="n">ysig</span><span class="p">:</span><span class="n">ymean</span><span class="o">+</span><span class="mi">3</span><span class="o">*</span><span class="n">ysig</span><span class="p">:</span><span class="nb">complex</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">npts</span><span class="p">)]</span>
<span class="n">Z</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Z</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
    <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Z</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
        <span class="n">logl</span><span class="p">,</span> <span class="n">logp</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">X</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span><span class="n">jj</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">Y</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span><span class="n">jj</span><span class="p">])</span>
        <span class="n">Z</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span> <span class="n">jj</span><span class="p">]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">logl</span><span class="o">+</span><span class="n">logp</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># we&#39;ll just animate the first 200 iterations; change this to</span>
<span class="c1"># nframes = xdata.shape[1]</span>
<span class="c1"># if you want to see all iterations</span>
<span class="n">nframes</span> <span class="o">=</span> <span class="mi">200</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">pyplot</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>

<span class="n">positions</span> <span class="o">=</span> <span class="n">sampler</span><span class="o">.</span><span class="n">positions</span>
<span class="n">xdata</span> <span class="o">=</span> <span class="n">positions</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span>
<span class="n">ydata</span> <span class="o">=</span> <span class="n">positions</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span>

<span class="c1"># Plot density map showing the shape of the true posterior density</span>
<span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">rot90</span><span class="p">(</span><span class="n">Z</span><span class="p">),</span> <span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="n">X</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">X</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">Y</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">Y</span><span class="o">.</span><span class="n">max</span><span class="p">()],</span>
          <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;binary&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=-</span><span class="mi">3</span><span class="p">)</span>

<span class="c1"># Put an x at the maximum posterior point</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">mean</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">model</span><span class="o">.</span><span class="n">mean</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=-</span><span class="mi">2</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
<span class="c1"># create the scatter points</span>
<span class="n">ptsize</span> <span class="o">=</span> <span class="mi">60</span>

<span class="c1"># we&#39;ll include the last bufferlen number of steps a chain visited, having the size and transparency</span>
<span class="c1"># exponentially damped with each new frame</span>
<span class="n">bufferlen</span> <span class="o">=</span> <span class="mi">16</span>
<span class="n">alphas</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="o">*</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">bufferlen</span><span class="p">))</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">bufferlen</span><span class="p">))</span>
<span class="n">sizes</span> <span class="o">=</span> <span class="n">ptsize</span> <span class="o">*</span> <span class="n">alphas</span>
<span class="c1">#colors = numpy.array([&#39;C{}&#39;.format(ii) for ii in range(nchains)])</span>
<span class="n">colors</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nchains</span><span class="p">)</span>
<span class="n">plts</span> <span class="o">=</span> <span class="p">[</span><span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">xdata</span><span class="p">[:,</span> <span class="n">bufferlen</span><span class="o">-</span><span class="n">ii</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">ydata</span><span class="p">[:,</span> <span class="n">bufferlen</span><span class="o">-</span><span class="n">ii</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="n">colors</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="n">sizes</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span>
                   <span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
                   <span class="n">alpha</span><span class="o">=</span><span class="n">alphas</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="n">zorder</span><span class="o">=</span><span class="n">bufferlen</span><span class="o">-</span><span class="n">ii</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;s&#39;</span> <span class="k">if</span> <span class="n">ii</span><span class="o">==</span><span class="mi">0</span> <span class="k">else</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;jet&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">bufferlen</span><span class="p">)]</span>
<span class="c1"># put a + showing the average of the chain positions at the current iteration</span>
<span class="n">meanplt</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">xdata</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">ydata</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;P&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
                     <span class="n">zorder</span><span class="o">=</span><span class="n">bufferlen</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># add some text giving the iteration</span>
<span class="n">itertxt</span> <span class="o">=</span> <span class="s1">&#39;Iteration </span><span class="si">{}</span><span class="s1">&#39;</span>
<span class="n">txt</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">itertxt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.03</span><span class="p">,</span> <span class="mf">0.94</span><span class="p">),</span> <span class="n">xycoords</span><span class="o">=</span><span class="s1">&#39;axes fraction&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">animate</span><span class="p">(</span><span class="n">ii</span><span class="p">):</span>
    <span class="n">txt</span><span class="o">.</span><span class="n">set_text</span><span class="p">(</span><span class="n">itertxt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ii</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">jj</span><span class="p">,</span><span class="n">plt</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">plts</span><span class="p">):</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">set_offsets</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">xdata</span><span class="p">[:,</span> <span class="nb">max</span><span class="p">(</span><span class="n">ii</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="mi">0</span><span class="p">)],</span> <span class="n">ydata</span><span class="p">[:,</span> <span class="nb">max</span><span class="p">(</span><span class="n">ii</span><span class="o">-</span><span class="n">jj</span><span class="p">,</span> <span class="mi">0</span><span class="p">)]])</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
    <span class="n">meanplt</span><span class="o">.</span><span class="n">set_offsets</span><span class="p">([</span><span class="n">xdata</span><span class="p">[:,</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">ydata</span><span class="p">[:,</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()])</span>
    <span class="c1"># zoom in as it narrows on the result</span>
    <span class="n">istart</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">ii</span><span class="o">-</span><span class="n">bufferlen</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="c1"># smooth it out a bit</span>
    <span class="n">xmin</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">xdata</span><span class="p">[:,</span> <span class="nb">max</span><span class="p">(</span><span class="n">istart</span><span class="o">-</span><span class="n">kk</span><span class="p">,</span> <span class="mi">0</span><span class="p">):]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">50</span><span class="p">)])</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="n">xmax</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">xdata</span><span class="p">[:,</span> <span class="nb">max</span><span class="p">(</span><span class="n">istart</span><span class="o">-</span><span class="n">kk</span><span class="p">,</span> <span class="mi">0</span><span class="p">):]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">50</span><span class="p">)])</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="n">ymin</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ydata</span><span class="p">[:,</span> <span class="nb">max</span><span class="p">(</span><span class="n">istart</span><span class="o">-</span><span class="n">kk</span><span class="p">,</span> <span class="mi">0</span><span class="p">):]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">50</span><span class="p">)])</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="n">ymax</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ydata</span><span class="p">[:,</span> <span class="nb">max</span><span class="p">(</span><span class="n">istart</span><span class="o">-</span><span class="n">kk</span><span class="p">,</span> <span class="mi">0</span><span class="p">):]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">50</span><span class="p">)])</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">((</span><span class="mf">1.1</span> <span class="k">if</span> <span class="n">xmin</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="mf">0.9</span><span class="p">)</span><span class="o">*</span><span class="n">xmin</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.9</span> <span class="k">if</span> <span class="n">xmax</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="mf">1.1</span><span class="p">)</span><span class="o">*</span><span class="n">xmax</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">((</span><span class="mf">1.1</span> <span class="k">if</span> <span class="n">ymin</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="mf">0.9</span><span class="p">)</span><span class="o">*</span><span class="n">ymin</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.9</span> <span class="k">if</span> <span class="n">ymax</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="mf">1.1</span><span class="p">)</span><span class="o">*</span><span class="n">ymax</span><span class="p">)</span>


<span class="n">ani</span> <span class="o">=</span> <span class="n">animation</span><span class="o">.</span><span class="n">FuncAnimation</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">animate</span><span class="p">,</span> <span class="n">frames</span><span class="o">=</span><span class="n">nframes</span><span class="p">,</span> <span class="n">interval</span><span class="o">=</span><span class="mi">160</span><span class="p">,</span> <span class="n">blit</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>Save the animation:</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ani</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s1">&#39;chain_animation.mp4&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The result:</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%HTML</span>
<span class="p">&lt;</span><span class="nt">video</span> <span class="na">width</span><span class="o">=</span><span class="s">&quot;640&quot;</span> <span class="na">height</span><span class="o">=</span><span class="s">&quot;480&quot;</span> <span class="na">controls</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">source</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;chain_animation.mp4&quot;</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;video/mp4&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">video</span><span class="p">&gt;</span>
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="01-chain.html" class="btn btn-neutral float-left" title="Using a chain" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="03-ptsampler.html" class="btn btn-neutral float-right" title="Example of creating and running a Parallel Tempered Sampler" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020, Collin D. Capano.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <!-- Modified from https://tech.michaelaltfield.net/2020/07/23/sphinx-rtd-github-pages-2/ -->


  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book">&nbsp; &nbsp;</span>
      Version: latest
      <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      
      <dl>
        
           <strong> 
          <dd><a href="">latest</a></dd>
           </strong> 
        
      </dl>
      
      
    </div>
  </div>
<script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>